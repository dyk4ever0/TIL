(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{320:function(t,s,a){"use strict";a.r(s);var e=a(14),r=Object(e.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"postgresql에서-두-스키마-간-데이터-이동"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#postgresql에서-두-스키마-간-데이터-이동"}},[t._v("#")]),t._v(" PostgreSQL에서 두 스키마 간 데이터 이동")]),t._v(" "),s("h4",{attrs:{id:"_1-postgresql에서-데이터-이동-및-권한-설정"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-postgresql에서-데이터-이동-및-권한-설정"}},[t._v("#")]),t._v(" 1. PostgreSQL에서 데이터 이동 및 권한 설정")]),t._v(" "),s("p",[s("strong",[t._v("1.1 "),s("code",[t._v("predict")]),t._v(" 스키마 삭제")])]),t._v(" "),s("p",[s("code",[t._v("predict")]),t._v(" 스키마를 삭제하여 초기화하고 모든 데이터를 새롭게 복사할 준비를 함.")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DROP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("IF")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXISTS")]),t._v(" predict "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CASCADE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("1.2 "),s("code",[t._v("predict")]),t._v(" 스키마 생성")])]),t._v(" "),s("p",[s("code",[t._v("predict")]),t._v("라는 새 스키마 생성")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("1.3 "),s("code",[t._v("public")]),t._v(" 테이블을 "),s("code",[t._v("predict")]),t._v("로 복사")])]),t._v(" "),s("p",[s("code",[t._v("public.ready_to_predict")]),t._v(" 테이블의 모든 데이터를 "),s("code",[t._v("predict.ready_to_predict")]),t._v(" 테이블로 복사")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("1.4 "),s("code",[t._v("aiserver")]),t._v(" 사용자에게 "),s("code",[t._v("predict")]),t._v(" 스키마 권한 부여")])]),t._v(" "),s("p",[s("code",[t._v("aiserver")]),t._v(" 사용자에게 "),s("code",[t._v("predict")]),t._v(" 스키마에 대한 접근 및 테이블 권한 부여")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USAGE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" predict "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" aiserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLES")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" predict "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" aiserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[s("strong",[t._v("1.5 앞으로 생성되는 테이블 권한 자동 부여 설정")])]),t._v(" "),s("p",[t._v("새로 생성되는 테이블에도 자동으로 권한 부여되는 설정임")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIVILEGES")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" predict\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLES")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" aiserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h4",{attrs:{id:"_2-데이터-비교-및-검증"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-데이터-비교-및-검증"}},[t._v("#")]),t._v(" 2. 데이터 비교 및 검증")]),t._v(" "),s("p",[s("strong",[t._v("2.1 "),s("code",[t._v("EXCEPT")]),t._v("를 통한 데이터 차이 비교")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("public")]),t._v("에만 존재하는 데이터:")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXCEPT")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("predict")]),t._v("에만 존재하는 데이터:")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXCEPT")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("2.2 행 수 확인")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("SELECT COUNT(*) AS row_count\nFROM predict.ready_to_predict;\n")])])]),s("h4",{attrs:{id:"_3-서버-코드-수정-사항"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-서버-코드-수정-사항"}},[t._v("#")]),t._v(" 3. 서버 코드 수정 사항")]),t._v(" "),s("p",[s("strong",[t._v("3.1 데이터베이스 적재 시 "),s("code",[t._v("predict")]),t._v(" 스키마 지정")])]),t._v(" "),s("p",[s("code",[t._v("pandas.DataFrame.to_sql")]),t._v(" 메서드에서 "),s("code",[t._v("schema='predict'")]),t._v("를 지정하여 데이터가 "),s("code",[t._v("predict")]),t._v(" 스키마에 저장되도록 변경")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("df_DB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to_sql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ready_to_predict'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 테이블 이름")]),t._v("\n    engine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 데이터베이스 엔진")]),t._v("\n    schema"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'predict'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 스키마 지정")]),t._v("\n    if_exists"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'append'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 데이터가 존재하면 추가")]),t._v("\n    index"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 인덱스 제외")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[s("strong",[t._v("3.2 데이터베이스 연결 테스트 엔드포인트 추가")])]),t._v(" "),s("p",[t._v("서버에서 데이터베이스 연결 및 "),s("code",[t._v("predict.ready_to_predict")]),t._v(" 테이블 조회를 테스트하기 위한 엔드포인트 추가")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('from sqlalchemy import text\n\n@app.get("/test-db-connection/")\ndef test_db_connection():\n    """\n    데이터베이스 연결 테스트 및 predict.ready_to_predict에서 데이터 확인\n    """\n    try:\n        with engine.connect() as conn:\n            query = text("SELECT * FROM predict.ready_to_predict LIMIT 1")\n            result = conn.execute(query)\n            df = pd.DataFrame(result.fetchall(), columns=result.keys())\n            \n            if df.empty:\n                return {"status": "success", "message": "Table is accessible but contains no data."}\n            \n            return {\n                "status": "success",\n                "message": "Database connection successful and data retrieved.",\n                "data": df.to_dict(orient="records")\n            }\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=f"An error occurred: {str(e)}")\n')])])]),s("h3",{attrs:{id:"postgresql에서-두-스키마-간-데이터-이동-및-서버-코드-수정-흐름"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#postgresql에서-두-스키마-간-데이터-이동-및-서버-코드-수정-흐름"}},[t._v("#")]),t._v(" PostgreSQL에서 두 스키마 간 데이터 이동 및 서버 코드 수정 흐름")]),t._v(" "),s("h4",{attrs:{id:"_1-postgresql에서-데이터-이동-및-권한-설정-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-postgresql에서-데이터-이동-및-권한-설정-2"}},[t._v("#")]),t._v(" 1. PostgreSQL에서 데이터 이동 및 권한 설정")]),t._v(" "),s("p",[s("strong",[t._v("1.1 "),s("code",[t._v("predict")]),t._v(" 스키마 삭제")])]),t._v(" "),s("p",[s("code",[t._v("predict")]),t._v(" 스키마를 삭제하여 초기화하고 모든 데이터를 새롭게 복사할 준비를 함.")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sql")]),t._v("코드 복사"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DROP")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("IF")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXISTS")]),t._v(" predict "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CASCADE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("hr"),t._v(" "),s("p",[s("strong",[t._v("1.2 "),s("code",[t._v("predict")]),t._v(" 스키마 생성")])]),t._v(" "),s("p",[s("code",[t._v("predict")]),t._v("라는 새 스키마를 생성함.")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("hr"),t._v(" "),s("p",[s("strong",[t._v("1.3 "),s("code",[t._v("public")]),t._v(" 테이블을 "),s("code",[t._v("predict")]),t._v("로 복사")])]),t._v(" "),s("p",[s("code",[t._v("public.ready_to_predict")]),t._v(" 테이블의 모든 데이터를 "),s("code",[t._v("predict.ready_to_predict")]),t._v(" 테이블로 복사함.")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("CREATE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLE")]),t._v(" predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("hr"),t._v(" "),s("p",[s("strong",[t._v("1.4 "),s("code",[t._v("aiserver")]),t._v(" 사용자에게 "),s("code",[t._v("predict")]),t._v(" 스키마 권한 부여")])]),t._v(" "),s("p",[s("code",[t._v("aiserver")]),t._v(" 사용자에게 "),s("code",[t._v("predict")]),t._v(" 스키마에 대한 접근 및 테이블 권한을 부여함.")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("USAGE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" predict "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" aiserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLES")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" predict "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" aiserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("hr"),t._v(" "),s("p",[s("strong",[t._v("1.5 앞으로 생성되는 테이블 권한 자동 부여 설정")])]),t._v(" "),s("p",[t._v("새로 생성되는 테이블에도 자동으로 권한이 부여되도록 설정함.")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALTER")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("DEFAULT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("PRIVILEGES")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("IN")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SCHEMA")]),t._v(" predict\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("GRANT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ALL")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ON")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TABLES")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("TO")]),t._v(" aiserver"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h4",{attrs:{id:"_2-데이터-비교-및-검증-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-데이터-비교-및-검증-2"}},[t._v("#")]),t._v(" 2. 데이터 비교 및 검증")]),t._v(" "),s("p",[s("strong",[t._v("2.1 "),s("code",[t._v("EXCEPT")]),t._v("를 통한 데이터 차이 비교")])]),t._v(" "),s("ul",[s("li",[s("code",[t._v("public")]),t._v("에만 존재하는 데이터:")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXCEPT")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("ul",[s("li",[s("code",[t._v("predict")]),t._v("에만 존재하는 데이터:")])]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("EXCEPT")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("hr"),t._v(" "),s("p",[s("strong",[t._v("2.2 행 수 확인")])]),t._v(" "),s("p",[s("code",[t._v("predict.ready_to_predict")]),t._v(" 테이블의 행 수를 확인하여 복사가 제대로 이루어졌는지 검증함.")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("COUNT")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("AS")]),t._v(" row_count\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ready_to_predict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h4",{attrs:{id:"_3-서버-코드-수정-사항-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-서버-코드-수정-사항-2"}},[t._v("#")]),t._v(" 3. 서버 코드 수정 사항")]),t._v(" "),s("p",[s("strong",[t._v("3.1 데이터베이스 적재 시 "),s("code",[t._v("predict")]),t._v(" 스키마 지정")])]),t._v(" "),s("p",[s("code",[t._v("pandas.DataFrame.to_sql")]),t._v(" 메서드에서 "),s("code",[t._v("schema='predict'")]),t._v("를 지정하여 데이터가 "),s("code",[t._v("predict")]),t._v(" 스키마에 저장되도록 변경함.")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[t._v("df_DB"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to_sql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ready_to_predict'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 테이블 이름")]),t._v("\n    engine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("              "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 데이터베이스 엔진")]),t._v("\n    schema"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'predict'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 스키마 지정")]),t._v("\n    if_exists"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'append'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 데이터가 존재하면 추가")]),t._v("\n    index"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("False")]),t._v("          "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 인덱스 제외")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("p",[s("strong",[t._v("3.2 데이터베이스 연결 테스트 엔드포인트 추가")])]),t._v(" "),s("p",[t._v("서버에서 데이터베이스 연결 및 "),s("code",[t._v("predict.ready_to_predict")]),t._v(" 테이블 조회를 테스트하기 위한 엔드포인트를 추가함.")]),t._v(" "),s("div",{staticClass:"language-python extra-class"},[s("pre",{pre:!0,attrs:{class:"language-python"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" sqlalchemy "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" text\n\n"),s("span",{pre:!0,attrs:{class:"token decorator annotation punctuation"}},[t._v("@app"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("get")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/test-db-connection/"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test_db_connection")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token triple-quoted-string string"}},[t._v('"""\n    데이터베이스 연결 테스트 및 predict.ready_to_predict에서 데이터 확인\n    """')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("with")]),t._v(" engine"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("connect"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            query "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" text"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"SELECT * FROM predict.ready_to_predict LIMIT 1"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" conn"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("execute"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("query"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            df "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("DataFrame"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fetchall"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" columns"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("keys"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            \n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" df"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("empty"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"success"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Table is accessible but contains no data."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            \n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"status"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"success"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"message"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Database connection successful and data retrieved."')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"data"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" df"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("to_dict"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("orient"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"records"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("except")]),t._v(" Exception "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("raise")]),t._v(" HTTPException"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("status_code"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" detail"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string-interpolation"}},[s("span",{pre:!0,attrs:{class:"token string"}},[t._v('f"An error occurred: ')]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("str")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("hr"),t._v(" "),s("h4",{attrs:{id:"_4-최종-흐름-요약"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-최종-흐름-요약"}},[t._v("#")]),t._v(" 4. 최종 흐름 요약")]),t._v(" "),s("ol",[s("li",[s("strong",[s("code",[t._v("predict")]),t._v(" 스키마 초기화")]),t._v(":\n"),s("ul",[s("li",[t._v("기존 "),s("code",[t._v("predict")]),t._v(" 스키마 삭제 후 새로 생성")]),t._v(" "),s("li",[s("code",[t._v("public.ready_to_predict")]),t._v(" 데이터를 "),s("code",[t._v("predict.ready_to_predict")]),t._v("로 복사")])])]),t._v(" "),s("li",[s("strong",[t._v("권한 설정")]),t._v(":\n"),s("ul",[s("li",[s("code",[t._v("aiserver")]),t._v(" 사용자에게 "),s("code",[t._v("predict")]),t._v(" 스키마와 테이블에 대한 권한 부여")]),t._v(" "),s("li",[t._v("앞으로 생성되는 테이블에 대해 권한 자동 부여 설정")])])]),t._v(" "),s("li",[s("strong",[t._v("데이터 검증")]),t._v(":\n"),s("ul",[s("li",[s("code",[t._v("EXCEPT")]),t._v(" 쿼리를 사용하여 데이터 차이 확인")]),t._v(" "),s("li",[s("code",[t._v("row_count")]),t._v("를 통해 행 수 검증")])])]),t._v(" "),s("li",[s("strong",[t._v("서버 코드 수정")]),t._v(":\n"),s("ul",[s("li",[s("code",[t._v("pandas.DataFrame.to_sql")]),t._v("에서 "),s("code",[t._v("schema='predict'")]),t._v(" 지정")]),t._v(" "),s("li",[t._v("데이터베이스 연결 및 쿼리 테스트 위한 GET 엔드포인트 추가")])])])])])}),[],!1,null,null,null);s.default=r.exports}}]);